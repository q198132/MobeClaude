<!DOCTYPE html>
<html lang="zh">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width,initial-scale=1,maximum-scale=1">
<title>MobeClaude - Êñá‰ª∂</title>
<link href="https://fonts.googleapis.com/css2?family=Space+Grotesk:wght@500;600&display=swap" rel="stylesheet">
<style>
*{margin:0;padding:0;box-sizing:border-box}
:root{--bg:#0F172A;--surface:#1E293B;--border:#334155;--text:#F8FAFC;--muted:#94A3B8;--accent:#22C55E;--accent2:#3B82F6;--danger:#EF4444}
body{background:var(--bg);color:var(--text);height:100dvh;display:flex;flex-direction:column;font-family:'DM Sans',sans-serif;overflow:hidden}
#topBar{display:flex;align-items:center;padding:8px 12px;background:var(--surface);border-bottom:1px solid var(--border);gap:8px;min-height:44px;flex-shrink:0}
#topBar a{color:var(--muted);text-decoration:none;font-size:1.1rem;padding:2px 6px;cursor:pointer}
#pathBar{flex:1;font-size:.75rem;color:var(--muted);overflow:hidden;text-overflow:ellipsis;white-space:nowrap}
#saveBtn{display:none;padding:5px 14px;background:var(--accent);color:#000;border:none;border-radius:8px;font-weight:600;font-size:.8rem;cursor:pointer}
#list{flex:1;overflow-y:auto;padding:8px 0}
#list::-webkit-scrollbar{width:4px}
#list::-webkit-scrollbar-thumb{background:var(--border);border-radius:2px}
.item{display:flex;align-items:center;gap:12px;padding:11px 16px;cursor:pointer;border-bottom:1px solid rgba(51,65,85,.4);transition:background .1s}
.item:active{background:var(--surface)}
.icon{width:32px;height:32px;border-radius:8px;display:flex;align-items:center;justify-content:center;flex-shrink:0;font-size:16px}
.icon.dir{background:rgba(59,130,246,.12);color:var(--accent2)}
.icon.file{background:rgba(148,163,184,.08);color:var(--muted)}
.name{font-size:.9rem;overflow:hidden;text-overflow:ellipsis;white-space:nowrap}
#editor{flex:1;display:none;flex-direction:column}
#editorTitle{padding:8px 16px;font-size:.8rem;color:var(--muted);background:var(--surface);border-bottom:1px solid var(--border);flex-shrink:0}
#code{flex:1;background:var(--bg);color:var(--text);border:none;outline:none;padding:12px 16px;font-family:Menlo,Monaco,'Courier New',monospace;font-size:13px;line-height:1.6;resize:none;width:100%;overflow-y:auto}
.empty{padding:32px 16px;text-align:center;color:var(--muted);font-size:.85rem}
</style>
</head>
<body>
<div id="topBar">
  <a id="backBtn">‚Üê</a>
  <span id="pathBar">/</span>
  <button id="saveBtn" onclick="saveFile()">‰øùÂ≠ò</button>
</div>
<div id="list"></div>
<div id="editor">
  <div id="editorTitle"></div>
  <textarea id="code" spellcheck="false"></textarea>
</div>

<script>
const token = new URLSearchParams(location.search).get('token');
const q = p => `${p}${p.includes('?')?'&':'?'}token=${token}`;
let curPath = '', curFile = '', inEditor = false;

async function loadDir(p) {
  const r = await fetch(q(`/api/files?path=${encodeURIComponent(p)}`));
  const data = await r.json();
  if (data.error) return;
  curPath = data.path;
  inEditor = false;
  document.getElementById('pathBar').textContent = curPath;
  document.getElementById('saveBtn').style.display = 'none';
  document.getElementById('editor').style.display = 'none';
  document.getElementById('list').style.display = 'block';

  const list = document.getElementById('list');
  list.innerHTML = '';

  if (data.parent !== data.path) {
    const up = document.createElement('div');
    up.className = 'item';
    up.innerHTML = `<div class="icon dir">‚Üë</div><div class="name">..</div>`;
    up.onclick = () => loadDir(data.parent);
    list.appendChild(up);
  }

  if (!data.items.length) {
    list.innerHTML += `<div class="empty">Á©∫ÁõÆÂΩï</div>`;
    return;
  }

  data.items.forEach(item => {
    const el = document.createElement('div');
    el.className = 'item';
    el.innerHTML = `<div class="icon ${item.isDir?'dir':'file'}">${item.isDir?'üìÅ':'üìÑ'}</div><div class="name">${item.name}</div>`;
    el.onclick = () => item.isDir ? loadDir(item.path) : openFile(item.path, item.name);
    list.appendChild(el);
  });
}

async function openFile(p, name) {
  const r = await fetch(q(`/api/file?path=${encodeURIComponent(p)}`));
  const data = await r.json();
  if (data.error) { alert(data.error); return; }
  curFile = p;
  inEditor = true;
  document.getElementById('editorTitle').textContent = name;
  document.getElementById('code').value = data.content;
  document.getElementById('list').style.display = 'none';
  document.getElementById('editor').style.display = 'flex';
  document.getElementById('saveBtn').style.display = 'block';
  document.getElementById('pathBar').textContent = name;
}

async function saveFile() {
  const btn = document.getElementById('saveBtn');
  btn.textContent = '‰øùÂ≠ò‰∏≠‚Ä¶';
  const r = await fetch(q('/api/file'), {
    method: 'POST',
    headers: { 'Content-Type': 'application/json' },
    body: JSON.stringify({ path: curFile, content: document.getElementById('code').value })
  });
  const data = await r.json();
  btn.textContent = data.ok ? 'Â∑≤‰øùÂ≠ò' : 'Â§±Ë¥•';
  setTimeout(() => { btn.textContent = '‰øùÂ≠ò'; }, 1500);
}

document.getElementById('backBtn').onclick = () => {
  if (inEditor) { loadDir(curPath); }
  else { history.back(); }
};

loadDir('');
</script>
</body>
</html>
